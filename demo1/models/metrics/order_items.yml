semantic_models:
  - name: order_item
    defaults:
      agg_time_dimension: ordered_at
    description: |
      Items contained in each order. Grain: one row per order item.
    model: ref('order_items')

    entities:
      - name: order_item
        type: primary
        expr: order_item_id
      - name: order_id
        type: foreign
        expr: order_id
      - name: product
        type: foreign
        expr: product_id

    dimensions:
      - name: ordered_at
        type: time
        expr: DATE(ordered_at)   # BigQuery-safe for TIMESTAMP/DATETIME
        type_params:
          time_granularity: day

      - name: is_food_item
        type: categorical
      - name: is_drink_item
        type: categorical

    measures:
      - name: revenue
        description: Revenue generated for each order item.
        agg: sum
        expr: product_price

      - name: food_revenue
        agg: sum
        expr: CASE WHEN is_food_item = 1 THEN product_price ELSE 0 END

      - name: drink_revenue
        agg: sum
        expr: CASE WHEN is_drink_item = 1 THEN product_price ELSE 0 END

metrics:
  - name: revenue
    label: revenue
    description: Total revenue from order items
    type: simple
    type_params:
      measure: revenue

  - name: food_revenue
    label: food_revenue
    description: Total food revenue from order items
    type: simple
    type_params:
      measure: food_revenue

  - name: drink_revenue
    label: drink_revenue
    description: Total drink revenue from order items
    type: simple
    type_params:
      measure: drink_revenue
